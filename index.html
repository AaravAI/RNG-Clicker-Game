<!doctype html>
<html>
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>RNG Clicker — Main + Event Box</title>
    <meta name="description" content="RNG Clicker — hatch skins from Main & Event boxes, stack PPC, rebirth for more equip slots. Autosave, offline progress." />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
      html,body,#root{height:100%;background:#08090b} *{box-sizing:border-box}
      .bg-grid{background-image:radial-gradient(rgba(255,255,255,.04) 1px,transparent 1px);background-size:24px 24px}
      .glass{backdrop-filter:blur(10px);background:rgba(16,16,20,.55)}
      .btn{transition:transform .06s ease,box-shadow .2s ease,opacity .2s ease;box-shadow:0 8px 24px rgba(0,0,0,.35),inset 0 0 0 1px rgba(255,255,255,.04)}
      .btn:active{transform:translateY(1px) scale(.995)}
      .btn-emerald{background:linear-gradient(180deg,#34d399,#059669)}
      .btn-sky{background:linear-gradient(180deg,#38bdf8,#0284c7)}
      .btn-rose{background:linear-gradient(180deg,#fb7185,#be123c)}
      .btn-fuchsia{background:linear-gradient(180deg,#e879f9,#a21caf)}
      .btn-amber{background:linear-gradient(180deg,#fbbf24,#b45309);color:#111827}
      .section{background:rgba(24,24,30,.65);border:1px solid rgba(120,120,140,.25)}
      .chip{background:rgba(20,20,26,.8);border:1px solid rgba(120,120,140,.25)}
      @keyframes floatUp{0%{transform:translateY(0) scale(1);opacity:1}70%{opacity:.9}100%{transform:translateY(-80px) scale(.96);opacity:0}}
      .particle{position:absolute;pointer-events:none;color:#faffff;font-weight:700;text-shadow:0 1px 0 rgba(0,0,0,.5);animation:floatUp 800ms ease forwards}
      .hero-gradient{background:radial-gradient(1200px 600px at 20% -20%, #1f2937 0%, transparent 60%),radial-gradient(1000px 500px at 120% 10%, #0ea5e9 0%, transparent 45%),radial-gradient(900px 600px at 50% 120%, #a78bfa 0%, transparent 45%),linear-gradient(180deg, #0b0f14 0%, #090a0e 100%)}
      @keyframes pop{0%{transform:scale(.9);opacity:0}60%{transform:scale(1.02);opacity:1}100%{transform:scale(1)}}
      .pop{animation:pop .35s ease both}
      /* cursor follower */
      .cursor-dot{position:fixed;top:0;left:0;pointer-events:none;width:14px;height:14px;border-radius:9999px;transform:translate(-50%,-50%);mix-blend-mode:difference;z-index:9999;border:2px solid rgba(255,255,255,.5);box-shadow:0 0 12px rgba(255,255,255,.25)}

      /* --- ADDED: subtle glow driven by top equipped skin color --- */
      .glow { box-shadow: 0 0 0 0 rgba(255,255,255,0.0); transition: box-shadow .25s ease; }
      .glow.use { box-shadow: 0 0 38px 6px var(--glow, rgba(255,255,255,.15)); }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const {useState,useEffect,useMemo,useRef} = React;

      /* ---------- utils ---------- */
      const UNITS=[{value:1e33,suffix:"Dc"},{value:1e30,suffix:"No"},{value:1e27,suffix:"Oc"},{value:1e24,suffix:"Sp"},{value:1e21,suffix:"Sx"},{value:1e18,suffix:"Qi"},{value:1e15,suffix:"Qa"},{value:1e12,suffix:"T"},{value:1e9,suffix:"B"},{value:1e6,suffix:"M"},{value:1e3,suffix:"k"}];
      const clamp2=x=>Math.round(x*100)/100;
      function fmt(n){if(!isFinite(n))return"∞";const a=Math.abs(n);for(const u of UNITS)if(a>=u.value)return(n/u.value).toFixed(2).replace(/\.00$/,"")+u.suffix;return Math.floor(n).toString()}
      function toRoman(num){if(num<=0)return"";const R=[[1000,'M'],[900,'CM'],[500,'D'],[400,'CD'],[100,'C'],[90,'XC'],[50,'L'],[40,'XL'],[10,'X'],[9,'IX'],[5,'V'],[4,'IV'],[1,'I']];let s='';for(const[v,t]of R){while(num>=v){s+=t;num-=v}}return s}
      function roll(table){const total=table.reduce((a,t)=>a+t.chance,0);let r=Math.random()*total,acc=0;for(const it of table){acc+=it.chance;if(r<acc)return it.rarity}return table[table.length-1].rarity}
      /* ADDED: colored particles */
      function spawnParticle(e,txt,color){
        const p=document.createElement("div");
        p.className="particle";
        p.style.left=e.clientX+"px";
        p.style.top=e.clientY+"px";
        if(color){ p.style.color=color; p.style.textShadow=`0 0 12px ${color}, 0 1px 0 rgba(0,0,0,.5)`; }
        p.textContent=txt;
        document.body.appendChild(p);
        setTimeout(()=>p.remove(),900);
      }

      /* ---------- data ---------- */
      const MAIN_BOX={cost:100,rng:[
        {rarity:"Common",chance:79.89899},
        {rarity:"Rare",chance:15},
        {rarity:"Epic",chance:4},
        {rarity:"Legendary",chance:1},
        {rarity:"Mythic",chance:0.1},
        {rarity:"Unique",chance:0.001},
        {rarity:"Impossible",chance:0.00001}
      ]};
      const EVENT_BOX={cost:100,tokenCost:1000,rng:[
        {rarity:"Nothing",chance:98.99},
        {rarity:"Event",chance:1},
        {rarity:"Special Event",chance:0.01}
      ]};
      const SKIN={
        name:"Skin",
        base:{Common:1,Rare:2,Epic:3,Legendary:4,Mythic:5,Unique:10,Impossible:30,Event:15,"Special Event":20},
        gain:{Common:1,Rare:2,Epic:3,Legendary:4,Mythic:5,Unique:10,Impossible:30,Event:15,"Special Event":20},
        colors:{Common:"#9CA3AF",Rare:"#3B82F6",Epic:"#8B5CF6",Legendary:"#F59E0B",Mythic:"#EF4444",Unique:"#7C3AED",Impossible:"#FFFFFF",Event:"#22c55e","Special Event":"#0ea5e9",Nothing:"#6b7280"}
      };
      const DISPLAY_RATES_MAIN=[{r:"Common",p:"79.799%"},{r:"Rare",p:"15%"},{r:"Epic",p:"4%"},{r:"Legendary",p:"1%"},{r:"Mythic",p:"0.1%"},{r:"Unique",p:"0.001%"},{r:"Impossible",p:"0.00001%"}];
      const DISPLAY_RATES_EVENT=[{r:"Nothing",p:"99%"},{r:"Event",p:"1%"},{r:"Special Event",p:"0.01%"}];

      /* ---------- storage ---------- */
      const SAVE_VERSION="rng_clicker_pages_cover_v3";
      const LS_KEY="rng_clicker_"+SAVE_VERSION;
      const defState={
        points:0,totalClicks:0,
        autoClickerLevel:0,
        autoOpenerActive:false,
        autoOpenerLevel:0,          // boxes per batch = 1 + level
        autoOpenerSpeedLevel:0,     // 0:1s, 1:0.5s, 2/3:0.25s
        autoOpenerMode:"main",
        lastSeen:Date.now(),
        inventory:[], invCap:100, invUpgrades:0,
        rebirths:0,
        eventTokens:0,
        showHelp:true,
        autoDelete:{Common:false,Rare:false,Epic:false,Legendary:false,Mythic:false},
      };
      const saveState=s=>{try{localStorage.setItem(LS_KEY,JSON.stringify(s))}catch{}};
      const loadState=()=>{try{const raw=localStorage.getItem(LS_KEY); if(raw) return {...defState,...JSON.parse(raw)}}catch{}; return {...defState};};

      /* ---------- math ---------- */
      const skinUpgradeCost=l=>10**(l+2);     // 100,1k,10k...
      const costAuto=l=>10**(l+2);           // autoclicker (cap 6)
      const costInv=n=>10**(n+2);            // +20 slots
      const costReb=n=>10**(n+2);            // +1 equip
      const costRate=l=>10**(l+2);           // opener rate
      function costSpeed(l){ if(l===0) return 1e3; if(l===1) return 1e6; if(l===2) return 1e8; return Infinity; } // 1k → 1M → 100M
      const speedInterval=l=> (l<=0?1 : l===1?0.5 : 0.25); // seconds; Lv3 stays 0.25
      const autoInt=l=>60/2**Math.min(l,6); const autoPerMin=l=>2**Math.min(l,6);
      const openRate=l=>1+l;
      const skinPpc=it=>SKIN.base[it.rarity]+SKIN.gain[it.rarity]*it.level;
      function equippedBest(inv,slots){
        const c=[]; for(const it of inv){const p=skinPpc(it); for(let k=0;k<it.qty;k++) c.push({rarity:it.rarity,level:it.level,ppc:p});}
        c.sort((a,b)=>b.ppc-a.ppc); const ch=c.slice(0,Math.max(1,slots));
        return{ppc:ch.reduce((a,e)=>a+e.ppc,0),label:ch.map(e=>`${e.rarity} ${SKIN.name} (${toRoman(e.level)||'I'}) +${e.ppc}`).join(" + "),top:ch[0]};
      }

      /* ---------- cursor that uses top equipped skin color ---------- */
      function CursorFollower({color}){
        const ref=useRef(null);
        useEffect(()=>{const el=ref.current;if(!el)return; const h=e=>{el.style.transform=`translate(${e.clientX}px,${e.clientY}px)`}; window.addEventListener("mousemove",h); return()=>window.removeEventListener("mousemove",h)},[]);
        return <div ref={ref} className="cursor-dot" style={{background:color || "#fff"}}/>;
      }

      /* ---------- Cover ---------- */
      function Cover({onStart}){
        return (
          <div className="fixed inset-0 z-50 hero-gradient bg-grid text-zinc-100 overflow-y-auto">
            <div className="max-w-6xl mx-auto px-6 py-12">
              <div className="grid lg:grid-cols-2 gap-8 items-start">
                <div className="relative">
                  <div className="relative rounded-3xl p-8 glass border border-zinc-700/60">
                    <div className="text-xs tracking-widest uppercase text-zinc-400">Idle RNG • Clicker • Autosave</div>
                    <h1 className="mt-2 text-5xl font-extrabold leading-tight">RNG Clicker</h1>

                    <div className="mt-4 space-y-4 text-zinc-300">
                      <div>
                        <h3 className="font-semibold text-lg">How to Play</h3>
                        <p>Click to earn <b>points</b>. Spend these points on the <b>Main Box</b> to get limited skins) or the <b>Event Box</b>. Skins increase your <b>PPC</b> (points per click), allowing you to get points faster. Upgrade your skins to imporve PPC, and <b>Rebirth</b> to equip more skins at the same time. Your progress auto-saves in the browser and also grows while you’re away.</p>
                      </div>

                      <div className="section rounded-2xl p-4">
                        <div className="text-sm font-semibold">Main Box — Drop Rates</div>
                        <div className="mt-3 grid grid-cols-7 gap-2 text-center text-xs">
                          {DISPLAY_RATES_MAIN.map(x=>(
                            <div key={x.r} className="rounded-xl p-3 chip">
                              <div className="w-5 h-5 mx-auto rounded-full" style={{background: SKIN.colors[x.r]}}></div>
                              <div className="mt-1 font-semibold">{x.r}</div>
                              <div className="text-zinc-400">{x.p}</div>
                            </div>
                          ))}
                        </div>
                        <div className="mt-2 text-[12px] text-zinc-400">
                          Power per copy: Common +1, Rare +2, Epic +3, Legendary +4, Mythic +5, Unique +10, Impossible +30.
                        </div>
                      </div>

                      <div className="section rounded-2xl p-4">
                        <div className="text-sm font-semibold">Event Box — Drop Rates</div>
                        <div className="mt-3 grid grid-cols-3 gap-2 text-center text-xs">
                          {DISPLAY_RATES_EVENT.map(x=>(
                            <div key={x.r} className="rounded-xl p-3 chip">
                              <div className="w-5 h-5 mx-auto rounded-full" style={{background: SKIN.colors[x.r]}}></div>
                              <div className="mt-1 font-semibold">{x.r}</div>
                              <div className="text-zinc-400">{x.p}</div>
                            </div>
                          ))}
                        </div>
                        <div className="mt-2 text-[12px] text-zinc-400">
                          Event Box costs <b>100 points + 1 token</b>. Tokens cost <b>1,000 points</b>. Event +15 PPC, Special Event +20 PPC.
                        </div>
                      </div>
                    </div>

                    <button className="mt-6 btn btn-emerald px-5 py-2.5 rounded-xl" onClick={onStart}>Start Playing</button>
                  </div>
                </div>

                <div className="relative">
                  <div className="relative rounded-[28px] border border-zinc-700/70 overflow-hidden glass">
                    <div className="p-6">
                      <div className="text-sm font-semibold mb-2">Upgrades — Detailed Guide</div>
                      <div className="space-y-4 text-sm text-zinc-300">
                        <div>
                          <div className="font-semibold">Autoclicker</div>
                          <p>The autoclicker taps for you. You can upgrade it using points to increase its rate!!</p>
                        </div>
                        <div>
                          <div className="font-semibold">Auto-Opener Rate</div>
                          <p>This function allows you to open boxes seemlessly and automatically, without manually clicking. This can work offline and it can be upgraded using points to increase its number of skins opened at one time.</p>
                        </div>
                        <div>
                          <div className="font-semibold">Auto-Opener Speed</div>
                          <p>This function increases rate of opening boxes, which can be upgraded using points.</p>
                        </div>
                        <div>
                          <div className="font-semibold">Expand Inventory</div>
                          <p>+20 slots per purchase so you can hold more skins.</p>
                        </div>
                        <div>
                          <div className="font-semibold">Skin Upgrades</div>
                          <p>Each skin can be upgraded to yield a higher PPC, thus improving your overall PPC</p>
                        </div>
                        <div>
                          <div className="font-semibold">Rebirth</div>
                          <p>You can only equip one skin, thus limiting your PPC. You can reset all you points to 0 but it grants you +1 equip slot, allowing you to use more than one skin at once, thus improving your overall PPC</p>
                        </div>
                        <div>
                          <div className="font-semibold">Auto-Delete</div>
                          <p>While auto-opening, this acts as an optional filter for fresh drops, deleting specific types of skins during opening of boxes. Auto-deleted skins refund 20% of Main Box cost instantly.</p>
                        </div>
                        <div>
                          <div className="font-semibold">Saving & Offline</div>
                          <p>Autosaves every few seconds. Autoclicker and Auto-Opener continue when you’re away and are settled on your next visit. </p>
                        </div>
                        <div className="text-[12px] text-zinc-400">Tip: The cursor color follows your strongest equipped skin. Flex that glow :)</div>
                      </div>
                    </div>
                  </div>
                </div>

              </div>
            </div>
          </div>
        );
      }

      /* ---------- App ---------- */
      function App(){
        const [state,setState]=useState(loadState());
        /* ADDED: hatch popup state */
        const [hatchPopup,setHatchPopup]=useState(null);
        const equipped=useMemo(()=>equippedBest(state.inventory,state.rebirths+1),[state.inventory,state.rebirths]);
        const ppc=useMemo(()=>1+equipped.ppc,[equipped]);
        const topColor=equipped.top ? SKIN.colors[equipped.top.rarity] : "#ffffff";

        // autosave
        useEffect(()=>{saveState(state)},[state]);
        useEffect(()=>{const id=setInterval(()=>saveState(state),5000);return()=>clearInterval(id)},[state]);
        useEffect(()=>{const h=()=>saveState(state);window.addEventListener("beforeunload",h);return()=>window.removeEventListener("beforeunload",h)},[state]);

        // OFFLINE catch-up (collect results for popup)
        useEffect(()=>{
          const now=Date.now(); const elapsed=(now-state.lastSeen)/1000; if(elapsed<=1) return;
          let pts=state.points, inv=[...state.inventory], tokens=state.eventTokens;
          const results=[];
          // autoclicker always accrues
          const acInt=autoInt(state.autoClickerLevel); pts+=Math.floor(elapsed/acInt);

          // auto-opener ticks
          if(state.autoOpenerActive){
            const rate=openRate(state.autoOpenerLevel);
            const intv=speedInterval(state.autoOpenerSpeedLevel);
            let ticks=Math.floor(elapsed/intv), ops=ticks*rate;
            while(ops-- > 0){
              const cnt=inv.reduce((a,i)=>a+i.qty,0);
              if(state.autoOpenerMode==="main"){
                if(pts<MAIN_BOX.cost||cnt>=state.invCap) break;
                pts-=MAIN_BOX.cost; const r=roll(MAIN_BOX.rng);
                if(state.autoDelete[r]){ const refund=Math.floor(MAIN_BOX.cost*0.2); pts+=refund; results.push({rarity:r,autoDeleted:true,refund,box:"Main"}); }
                else{ const idx=inv.findIndex(i=>i.rarity===r); if(idx>=0) inv[idx]={...inv[idx],qty:inv[idx].qty+1}; else inv.push({rarity:r,level:0,qty:1}); results.push({rarity:r,autoDeleted:false,refund:0,box:"Main"}); }
              }else{
                if(tokens<=0||pts<EVENT_BOX.cost||cnt>=state.invCap) break;
                pts-=EVENT_BOX.cost; tokens-=1; const r=roll(EVENT_BOX.rng);
                if(r==="Nothing"){ results.push({rarity:"Nothing",autoDeleted:false,refund:0,box:"Event"}); }
                else{ const idx=inv.findIndex(i=>i.rarity===r); if(idx>=0) inv[idx]={...inv[idx],qty:inv[idx].qty+1}; else inv.push({rarity:r,level:0,qty:1}); results.push({rarity:r,autoDeleted:false,refund:0,box:"Event"}); }
              }
            }
          }
          if(results.length) setHatchPopup({items:results,count:results.length});
          setState(s=>({...s,points:pts,inventory:inv,eventTokens:tokens,lastSeen:now}));
        },[]);

        // online autoclicker (never pauses)
        useEffect(()=>{
          let acc=0; const tick=100;
          const id=setInterval(()=>{ setState(s=>{
            acc+=tick/1000; const intv=autoInt(s.autoClickerLevel);
            let gained=0; while(acc>=intv){gained++; acc-=intv;}
            if(gained===0) return s; return {...s,points:s.points+gained,lastSeen:Date.now()};
          }) },tick);
          return()=>clearInterval(id);
        },[]);

        // auto-opener loop (online) — gather results + popup
        useEffect(()=>{
          if(!state.autoOpenerActive) return;
          const ms=speedInterval(state.autoOpenerSpeedLevel)*1000;
          const id=setInterval(()=>{
            setState(s=>{
              const rate=openRate(s.autoOpenerLevel);
              let pts=s.points, inv=[...s.inventory], tokens=s.eventTokens;
              const results=[];
              for(let i=0;i<rate;i++){
                const cnt=inv.reduce((a,i)=>a+i.qty,0);
                if(cnt>=s.invCap) { setHatchPopup(results.length?{items:results,count:results.length}:null); return {...s,autoOpenerActive:false,lastSeen:Date.now(),points:pts,inventory:inv,eventTokens:tokens}; }
                if(s.autoOpenerMode==="main"){
                  if(pts<MAIN_BOX.cost) { setHatchPopup(results.length?{items:results,count:results.length}:null); return {...s,autoOpenerActive:false,lastSeen:Date.now(),points:pts,inventory:inv,eventTokens:tokens}; }
                  pts-=MAIN_BOX.cost; const r=roll(MAIN_BOX.rng);
                  if(s.autoDelete[r]){ const refund=Math.floor(MAIN_BOX.cost*0.2); pts+=refund; results.push({rarity:r,autoDeleted:true,refund,box:"Main"}); }
                  else{ const idx=inv.findIndex(it=>it.rarity===r); if(idx>=0) inv[idx]={...inv[idx],qty:inv[idx].qty+1}; else inv.push({rarity:r,level:0,qty:1}); results.push({rarity:r,autoDeleted:false,refund:0,box:"Main"}); }
                }else{
                  if(tokens<=0 || pts<EVENT_BOX.cost) { setHatchPopup(results.length?{items:results,count:results.length}:null); return {...s,autoOpenerActive:false,lastSeen:Date.now(),points:pts,inventory:inv,eventTokens:tokens}; }
                  pts-=EVENT_BOX.cost; tokens-=1; const r=roll(EVENT_BOX.rng);
                  if(r==="Nothing"){ results.push({rarity:"Nothing",autoDeleted:false,refund:0,box:"Event"}); }
                  else{ const idx=inv.findIndex(it=>it.rarity===r); if(idx>=0) inv[idx]={...inv[idx],qty:inv[idx].qty+1}; else inv.push({rarity:r,level:0,qty:1}); results.push({rarity:r,autoDeleted:false,refund:0,box:"Event"}); }
                }
              }
              if(results.length) setHatchPopup({items:results,count:results.length});
              return {...s,points:pts,inventory:inv,eventTokens:tokens,lastSeen:Date.now()};
            });
          },ms);
          return()=>clearInterval(id);
        },[state.autoOpenerActive,state.autoOpenerLevel,state.autoOpenerSpeedLevel,state.autoOpenerMode]);

        /* ---------- actions ---------- */
        const clickPlay=e=>{ setState(s=>({...s,points:s.points+ppc,totalClicks:s.totalClicks+1})); if(e) spawnParticle(e,`+${ppc}`, topColor); };
        const invCount=s=>s.inventory.reduce((a,i)=>a+i.qty,0);
        const openMain=()=>setState(s=>{
          if(s.points<MAIN_BOX.cost||invCount(s)>=s.invCap) return s;
          let pts=s.points-MAIN_BOX.cost; const r=roll(MAIN_BOX.rng);
          if(s.autoDelete[r]) return {...s,points:pts+Math.floor(MAIN_BOX.cost*0.2)};
          const inv=[...s.inventory]; const idx=inv.findIndex(i=>i.rarity===r); if(idx>=0) inv[idx]={...inv[idx],qty:inv[idx].qty+1}; else inv.push({rarity:r,level:0,qty:1});
          /* ADDED: popup for manual opens */
          setHatchPopup({items:[{rarity:r,autoDeleted:false,refund:0,box:"Main"}],count:1});
          return {...s,points:pts,inventory:inv};
        });
        const openEvent=()=>setState(s=>{
          if(s.eventTokens<=0||s.points<EVENT_BOX.cost||invCount(s)>=s.invCap) return s;
          let pts=s.points-EVENT_BOX.cost; let tok=s.eventTokens-1; const r=roll(EVENT_BOX.rng);
          if(r==="Nothing"){ setHatchPopup({items:[{rarity:"Nothing",autoDeleted:false,refund:0,box:"Event"}],count:1}); return {...s,points:pts,eventTokens:tok}; }
          const inv=[...s.inventory]; const idx=inv.findIndex(i=>i.rarity===r); if(idx>=0) inv[idx]={...inv[idx],qty:inv[idx].qty+1}; else inv.push({rarity:r,level:0,qty:1});
          /* ADDED: popup for manual opens */
          setHatchPopup({items:[{rarity:r,autoDeleted:false,refund:0,box:"Event"}],count:1});
          return {...s,points:pts,eventTokens:tok,inventory:inv};
        });
        const buyToken=()=>setState(s=> s.points>=EVENT_BOX.tokenCost?{...s,points:s.points-EVENT_BOX.tokenCost,eventTokens:s.eventTokens+1}:s);
        const upgradeSkin=it=>{
          const cost=skinUpgradeCost(it.level);
          setState(s=>{
            if(s.points<cost) return s;
            const inv=[...s.inventory]; const idx=inv.findIndex(x=>x.rarity===it.rarity); if(idx<0) return s;
            inv[idx]={...inv[idx],level:inv[idx].level+1}; return {...s,points:s.points-cost,inventory:inv};
          });
        };
        const deletePets=it=>{
          const max=it.qty; const n=prompt(`Delete how many ${it.rarity} ${SKIN.name}? (0–${max})`,"1");
          if(n===null) return; const k=Math.max(0,Math.min(max,Math.floor(Number(n)||0))); if(k<=0) return;
          const each=Math.floor(MAIN_BOX.cost*0.2);
          if(!confirm(`Confirm delete ${k}? You’ll get ${fmt(each*k)} points.`)) return;
          setState(s=>{const inv=[...s.inventory]; const idx=inv.findIndex(x=>x.rarity===it.rarity); if(idx<0) return s; const left=inv[idx].qty-k; if(left<=0) inv.splice(idx,1); else inv[idx]={...inv[idx],qty:left}; return {...s,points:s.points+each*k,inventory:inv};});
        };

        const upgradeAuto=()=>setState(s=> (s.autoClickerLevel>=6||s.points<costAuto(s.autoClickerLevel))?s:{...s,points:s.points-costAuto(s.autoClickerLevel),autoClickerLevel:s.autoClickerLevel+1});
        const upgradeRate=()=>setState(s=> s.points<costRate(s.autoOpenerLevel)?s:{...s,points:s.points-costRate(s.autoOpenerLevel),autoOpenerLevel:s.autoOpenerLevel+1});
        const upgradeSpeed=()=>setState(s=> (s.autoOpenerSpeedLevel>=3||s.points<costSpeed(s.autoOpenerSpeedLevel))?s:{...s,points:s.points-costSpeed(s.autoOpenerSpeedLevel),autoOpenerSpeedLevel:s.autoOpenerSpeedLevel+1});
        const expandInv=()=>setState(s=> s.points<costInv(s.invUpgrades)?s:{...s,points:s.points-costInv(s.invUpgrades),invCap:s.invCap+20,invUpgrades:s.invUpgrades+1});
        const rebirth=()=>setState(s=> s.points<costReb(s.rebirths)?s:{...s,points:0,rebirths:s.rebirths+1});

        /* ---------- UI ---------- */
        return (
          <div className="w-screen h-screen text-zinc-100 overflow-hidden select-none">
            {/* color-changing cursor */}
            <CursorFollower color={topColor} />

            {state.showHelp && <Cover onStart={()=>setState(s=>({...s,showHelp:false}))} />}

            {/* top bar */}
            <div className="fixed top-0 inset-x-0 p-2 flex items-center justify-between bg-zinc-950/70 backdrop-blur border-b border-zinc-800 z-40">
              <div className="flex items-center gap-2">
                <button className="btn px-3 py-1.5 rounded-lg bg-zinc-800 hover:bg-zinc-700 text-sm" onClick={()=>setState(s=>({...s,showHelp:true}))}>❓ Help</button>
                <div className="flex items-center gap-1 bg-zinc-800/70 border border-zinc-700 rounded-lg px-2 py-1">
                  <span className="text-xs text-zinc-300">Auto-Opener:</span>
                  <label className="text-xs flex items-center gap-1">
                    <input type="radio" name="mode" checked={state.autoOpenerMode==='main'} onChange={()=>setState(s=>({...s,autoOpenerMode:'main'}))}/> Main
                  </label>
                  <label className="text-xs flex items-center gap-1">
                    <input type="radio" name="mode" checked={state.autoOpenerMode==='event'} onChange={()=>setState(s=>({...s,autoOpenerMode:'event'}))}/> Event
                  </label>
                </div>
                <button className={`btn px-3 py-1.5 rounded-lg text-sm ${state.autoOpenerActive? "btn-amber":"btn-emerald"}`}
                        onClick={()=>!state.autoOpenerActive && setState(s=>({...s,autoOpenerActive:true}))}>
                  {state.autoOpenerActive ? "Auto-Opener running…" : "Start Auto-Opener"}
                </button>
                <span className="text-xs text-zinc-400">Stop: CTRL+5</span>
              </div>
              <div className="flex items-center gap-3 text-xs text-zinc-300">
                <span>PPC: <b>{ppc}</b></span>
                <span>• Auto: every {clamp2(autoInt(state.autoClickerLevel))}s (≈ {autoPerMin(state.autoClickerLevel)}/min)</span>
                <span>• Opener: {openRate(state.autoOpenerLevel)} / {clamp2(speedInterval(state.autoOpenerSpeedLevel))}s ({state.autoOpenerMode})</span>
                <span>• Tokens: {state.eventTokens}</span>
                <span>• Rebirths: {state.rebirths}</span>
                <span>• Inv: {state.inventory.reduce((a,i)=>a+i.qty,0)}/{state.invCap}</span>
                <span>• Points: <b>{fmt(state.points)}</b></span>
                <button className="btn px-3 py-1.5 rounded-lg bg-zinc-800 hover:bg-zinc-700 text-sm" onClick={()=>{
                  const raw=JSON.stringify(state); const blob=new Blob([raw],{type:"application/json"});
                  const url=URL.createObjectURL(blob); const a=document.createElement("a"); a.href=url; a.download="rng_clicker_save.json"; a.click(); URL.revokeObjectURL(url);
                }}>Export</button>
                <label className="btn px-3 py-1.5 rounded-lg bg-zinc-800 hover:bg-zinc-700 text-sm cursor-pointer">
                  Import<input type="file" accept="application/json" className="hidden" onChange={(ev)=>{
                    const f=ev.target.files?.[0]; if(!f) return; const r=new FileReader();
                    r.onload=()=>{try{const obj=JSON.parse(String(r.result||"{}")); const merged={...defState,...obj,lastSeen:Date.now()}; setState(merged); saveState(merged); alert("Save imported!")}catch{alert("Invalid save file.")}};
                    r.readAsText(f); ev.target.value="";
                  }}/>
                </label>
              </div>
            </div>

            {/* layout */}
            <div className="pt-14 grid grid-cols-5 gap-4 h-full p-4">
              {/* Click Zone with glow */}
              <div className="col-span-3">
                <div className="relative w-full h-full section rounded-2xl overflow-hidden glow use"
                     style={{'--glow': topColor}}
                     onClick={(e)=>clickPlay(e)}>
                  <div className="relative h-full flex items-center justify-center">
                    <div className="text-center">
                      <div className="text-6xl font-extrabold drop-shadow">{fmt(state.points)}</div>
                      <div className="text-zinc-400 mt-2">points</div>
                      <div className="mt-6 text-2xl">Click anywhere in this box (+{ppc} per click)</div>
                      <div className="mt-2 text-zinc-400">Equipped: {equipped.label || "None"}</div>
                    </div>
                  </div>
                </div>
              </div>

              {/* Right Panel */}
              <div className="col-span-2 h-full min-h-0">
                <div className="h-full overflow-y-auto pr-2 flex flex-col gap-4">

                  {/* Open Boxes */}
                  <div className="section rounded-2xl p-4">
                    <div className="text-xl font-semibold">Open Boxes</div>

                    <div className="mt-2 flex items-center justify-between rounded-xl p-3 chip">
                      <div>
                        <div className="font-medium">Main Box</div>
                        <div className="text-sm text-zinc-400">Cost: {fmt(MAIN_BOX.cost)}</div>
                        <div className="text-xs text-zinc-500 mt-1">C 79.799% • R 15% • E 4% • L 1% • M 0.1% • U 0.001% • IMP 0.00001%</div>
                      </div>
                      <button className={`btn px-3 py-2 rounded-lg text-sm ${(state.points>=MAIN_BOX.cost && state.inventory.reduce((a,i)=>a+i.qty,0)<state.invCap) ? "btn-emerald" : "bg-zinc-700 cursor-not-allowed"}`} onClick={openMain}>Open</button>
                    </div>

                    <div className="mt-2 flex items-center justify-between rounded-xl p-3 chip">
                      <div>
                        <div className="font-medium">Event Box</div>
                        <div className="text-sm text-zinc-400">Cost: {fmt(EVENT_BOX.cost)} + 1 token • Tokens: <b>{state.eventTokens}</b></div>
                        <div className="text-xs text-zinc-500 mt-1">Nothing 99% • Event 1% • Special 0.01%</div>
                      </div>
                      <div className="flex gap-2">
                        <button className={`btn px-3 py-2 rounded-lg text-sm ${(state.points>=EVENT_BOX.cost && state.eventTokens>0 && state.inventory.reduce((a,i)=>a+i.qty,0)<state.invCap) ? "btn-amber" : "bg-zinc-700 cursor-not-allowed"}`} onClick={openEvent}>Open</button>
                        <button className={`btn px-3 py-2 rounded-lg text-sm ${state.points>=EVENT_BOX.tokenCost ? "btn-sky" : "bg-zinc-700 cursor-not-allowed"}`} onClick={buyToken}>Buy Token ({fmt(EVENT_BOX.tokenCost)})</button>
                      </div>
                    </div>

                    <div className="mt-2 flex items-center justify-between rounded-xl p-3 chip">
                      <div>
                        <div className="font-medium">Expand Inventory</div>
                        <div className="text-xs text-zinc-400">+20 slots • Next cost {fmt(costInv(state.invUpgrades))}</div>
                      </div>
                      <button className={`btn px-3 py-2 rounded-lg text-sm ${state.points>=costInv(state.invUpgrades) ? "btn-sky" : "bg-zinc-700 cursor-not-allowed"}`} onClick={expandInv}>Buy</button>
                    </div>
                  </div>

                  {/* Inventory */}
                  <div className="section rounded-2xl p-4">
                    <div className="flex items-center justify-between">
                      <div className="text-xl font-semibold">Inventory</div>
                      <details className="text-sm">
                        <summary className="cursor-pointer text-zinc-300">Auto-Delete Settings</summary>
                        <div className="mt-2 grid grid-cols-5 gap-2 text-xs">
                          {["Common","Rare","Epic","Legendary","Mythic"].map(r=>(
                            <label key={r} className="flex items-center gap-2 px-2 py-1 rounded-md chip">
                              <input type="checkbox" checked={!!state.autoDelete[r]} onChange={e=>setState(s=>({...s,autoDelete:{...s.autoDelete,[r]:e.target.checked}}))}/>
                              <span>{r}</span>
                            </label>
                          ))}
                        </div>
                        <div className="mt-1 text-[11px] text-zinc-400">Deletes fresh drops only and refunds 20% of Main Box cost.</div>
                      </details>
                    </div>
                    <div className="mt-2 grid grid-cols-1 gap-2">
                      {state.inventory.length===0 && (<div className="text-zinc-400 text-sm">No skins yet. Open boxes!</div>)}
                      {state.inventory.map(it=>{
                        const cost=skinUpgradeCost(it.level); const can=state.points>=cost;
                        return (
                          <div key={it.rarity} className="flex items-center justify-between rounded-xl p-3 chip">
                            <div>
                              <div className="font-medium">{it.rarity} {SKIN.name} <span className="opacity-70">{toRoman(it.level)||'I'}</span></div>
                              <div className="text-xs text-zinc-300">+{skinPpc(it)} PPC • Copies {it.qty}</div>
                            </div>
                            <div className="flex items-center gap-2">
                              <button className={`btn px-3 py-2 rounded-lg text-sm ${can? "btn-sky":"bg-zinc-700 cursor-not-allowed"}`} onClick={()=>upgradeSkin(it)}>
                                Upgrade ({fmt(cost)})
                              </button>
                              <button className="px-2 py-1 rounded-md bg-zinc-800 hover:bg-zinc-700 text-xs" title="Delete copies" onClick={()=>deletePets(it)}>🗑️</button>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>

                  {/* Upgrades */}
                  <div className="section rounded-2xl p-4">
                    <div className="text-xl font-semibold">Upgrades</div>

                    <div className="mt-3 flex items-center justify-between rounded-xl p-3 chip">
                      <div>
                        <div className="font-medium">Autoclicker Lv {state.autoClickerLevel} {state.autoClickerLevel>=6 && "(MAX)"}</div>
                        <div className="text-xs text-zinc-400">Autoclicks for you. Upgrading it increases its rate </div>
                      </div>
                      <button className={`btn px-3 py-2 rounded-lg text-sm ${
                        state.autoClickerLevel>=6 ? "bg-zinc-700 cursor-not-allowed" :
                        (state.points>=costAuto(state.autoClickerLevel) ? "btn-fuchsia" : "bg-zinc-700 cursor-not-allowed")
                      }`} onClick={upgradeAuto}>
                        {state.autoClickerLevel>=6 ? "Maximum" : `Upgrade (${fmt(costAuto(state.autoClickerLevel))})`}
                      </button>
                    </div>

                    <div className="mt-3 flex items-center justify-between rounded-xl p-3 chip">
                      <div>
                        <div className="font-medium">Auto-Opener Rate Lv {state.autoOpenerLevel} — {openRate(state.autoOpenerLevel)} per batch</div>
                        <div className="text-xs text-zinc-400">This upgrade opens up more boxes at one time for the auto-opener</div>
                      </div>
                      <button className={`btn px-3 py-2 rounded-lg text-sm ${state.points>=costRate(state.autoOpenerLevel) ? "btn-emerald" : "bg-zinc-700 cursor-not-allowed"}`} onClick={upgradeRate}>
                        Upgrade ({fmt(costRate(state.autoOpenerLevel))})
                      </button>
                    </div>

                    <div className="mt-3 flex items-center justify-between rounded-xl p-3 chip">
                      <div>
                        <div className="font-medium">Auto-Opener Speed Lv {state.autoOpenerSpeedLevel} {state.autoOpenerSpeedLevel>=3 && "(MAX)"}</div>
                        <div className="text-xs text-zinc-400">This update increases the speed at which hatching takes place</div>
                      </div>
                      <button className={`btn px-3 py-2 rounded-lg text-sm ${
                        state.autoOpenerSpeedLevel>=3 ? "bg-zinc-700 cursor-not-allowed" :
                        (state.points>= (state.autoOpenerSpeedLevel===0?1e3:state.autoOpenerSpeedLevel===1?1e6:1e8) ? "btn-amber" : "bg-zinc-700 cursor-not-allowed")
                      }`} onClick={upgradeSpeed}>
                        {state.autoOpenerSpeedLevel>=3 ? "Maximum" : `Upgrade (${fmt(state.autoOpenerSpeedLevel===0?1e3:state.autoOpenerSpeedLevel===1?1e6:1e8)})`}
                      </button>
                    </div>

                    <div className="mt-3 flex items-center justify-between rounded-xl p-3 chip">
                      <div>
                        <div className="font-medium">Rebirth</div>
                        <div className="text-xs text-zinc-400">Reset points to gain +1 equip slot. Your items stay.</div>
                      </div>
                      <button className={`btn px-3 py-2 rounded-lg text-sm ${state.points>=costReb(state.rebirths) ? "btn-rose" : "bg-zinc-700 cursor-not-allowed"}`} onClick={rebirth}>+1 Equip ({fmt(costReb(state.rebirths))})</button>
                    </div>
                  </div>

                </div>
              </div>
            </div>

            {/* ADDED: Hatch popup (manual & auto) */}
            {hatchPopup && (
              <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/70" onClick={()=>setHatchPopup(null)}>
                <div className="relative w-[560px] max-h-[70vh] overflow-y-auto border border-zinc-700 rounded-2xl bg-zinc-900 p-4 pop">
                  <div className="text-sm text-zinc-300">Opened {hatchPopup.count} {hatchPopup.count>1?"boxes":"box"}</div>
                  <div className="mt-2 space-y-2">
                    {hatchPopup.items.map((it,idx)=>(
                      <div key={idx} className="flex items-center justify-between rounded-xl p-3 bg-zinc-950/60 border border-zinc-800">
                        <div className="font-semibold">
                          {it.rarity==="Nothing"?"Nothing":`${it.rarity} ${SKIN.name}`}
                          <span className="text-xs text-zinc-500 ml-2">({it.box})</span>
                        </div>
                        <div className="text-sm">
                          {it.rarity==="Nothing" ? <span className="text-zinc-400">nothing</span> :
                            (it.autoDeleted ? <span className="text-amber-400">(auto-deleted +{fmt(it.refund)})</span> : <span className="text-emerald-400">kept</span>)}
                        </div>
                      </div>
                    ))}
                  </div>
                  <div className="mt-3 text-right">
                    <button className="btn btn-emerald px-4 py-2 rounded-xl" onClick={()=>setHatchPopup(null)}>Nice!</button>
                  </div>
                </div>
              </div>
            )}
          </div>
        );
      }

      ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
    </script>
  </body>
</html>
